<!--<!DOCTYPE html>-->
<!--<html xmlns:th="http://www.thymeleaf.org">-->
<!--<head>-->
<!--    <title th:text="'D√©tails des pr√©dictions pour ' + ${predictedName}"></title>-->
<!--    <meta charset="UTF-8">-->
<!--    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">-->
<!--    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css" rel="stylesheet">-->
<!--    <style>-->
<!--        :root {-->
<!--            &#45;&#45;primary-color: #4A90E2; /* Bleu plus doux */-->
<!--            &#45;&#45;secondary-color: #6C757D; /* Gris */-->
<!--            &#45;&#45;light-bg: #ECF0F1; /* Gris clair pour l'arri√®re-plan */-->
<!--            &#45;&#45;card-bg: #FFFFFF; /* Blanc pour les cartes */-->
<!--            &#45;&#45;text-color: #34495E; /* Gris fonc√© pour le texte */-->
<!--            &#45;&#45;border-color: #DDE6ED;-->
<!--            &#45;&#45;dark-heading-color: #2C3E50; /* Couleur des titres */-->
<!--        }-->

<!--        body {-->
<!--            margin: 0;-->
<!--            padding: 0;-->
<!--            background-color: var(&#45;&#45;light-bg);-->
<!--            font-family: 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;-->
<!--            display: flex;-->
<!--            color: var(&#45;&#45;text-color);-->
<!--        }-->

<!--        /* Styles de la sidebar (non modifi√©s, repris de votre code original) */-->
<!--        .sidebar {-->
<!--            width: 220px;-->
<!--            background-color: #1e1e2f;-->
<!--            color: white;-->
<!--            padding: 20px;-->
<!--            height: 100vh;-->
<!--            position: fixed;-->
<!--            top: 0;-->
<!--            left: 0;-->
<!--            display: flex;-->
<!--            flex-direction: column;-->
<!--        }-->

<!--        .sidebar h3 {-->
<!--            text-align: center;-->
<!--            margin-bottom: 30px;-->
<!--            font-size: 24px;-->
<!--        }-->

<!--        .sidebar a {-->
<!--            text-decoration: none;-->
<!--            color: #ccc;-->
<!--            padding: 12px;-->
<!--            margin: 5px 0;-->
<!--            border-radius: 8px;-->
<!--            display: flex;-->
<!--            align-items: center;-->
<!--            transition: background 0.3s;-->
<!--        }-->

<!--        .sidebar a:hover {-->
<!--            background-color: #333;-->
<!--            color: #fff;-->
<!--        }-->

<!--        .sidebar i {-->
<!--            margin-right: 10px;-->
<!--        }-->

<!--        /* Fin des styles de la sidebar */-->

<!--        .main-content {-->
<!--            margin-left: 220px;-->
<!--            padding: 40px;-->
<!--            flex-grow: 1;-->
<!--            width: calc(100% - 220px);-->
<!--        }-->

<!--        h2 {-->
<!--            color: var(&#45;&#45;dark-heading-color);-->
<!--            margin-bottom: 30px;-->
<!--            font-weight: 600;-->
<!--        }-->

<!--        .prediction-detail-card {-->
<!--            background-color: var(&#45;&#45;card-bg);-->
<!--            border-radius: 12px;-->
<!--            padding: 25px;-->
<!--            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.08);-->
<!--            margin-bottom: 25px;-->
<!--            display: flex;-->
<!--            align-items: center;-->
<!--            gap: 25px;-->
<!--            transition: transform 0.3s ease, box-shadow 0.3s ease;-->
<!--        }-->

<!--        .prediction-detail-card:hover {-->
<!--            transform: translateY(-5px);-->
<!--            box-shadow: 0 8px 20px rgba(0, 0, 0, 0.12);-->
<!--        }-->

<!--        .prediction-detail-img {-->
<!--            /* -&#45;&#45; MODIFICATIONS ICI -&#45;&#45; */-->
<!--            width: 160px; /* Taille augment√©e */-->
<!--            height: 160px; /* Taille augment√©e */-->
<!--            /* -&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45; */-->
<!--            object-fit: cover;-->
<!--            border-radius: 50%; /* Image ronde */-->
<!--            border: 3px solid var(&#45;&#45;primary-color);-->
<!--            box-shadow: 0 3px 8px rgba(0,0,0,0.1);-->
<!--            flex-shrink: 0;-->
<!--        }-->

<!--        .prediction-detail-info {-->
<!--            flex-grow: 1;-->
<!--            line-height: 1.6;-->
<!--        }-->

<!--        .prediction-detail-info p {-->
<!--            margin-bottom: 8px;-->
<!--            font-size: 1em;-->
<!--            color: var(&#45;&#45;text-color);-->
<!--        }-->

<!--        .prediction-detail-info strong {-->
<!--            color: var(&#45;&#45;dark-heading-color);-->
<!--            min-width: 120px;-->
<!--            display: inline-block;-->
<!--        }-->

<!--        .btn-primary, .btn-see-suspect {-->
<!--            background-color: var(&#45;&#45;primary-color);-->
<!--            border: none;-->
<!--            color: white;-->
<!--            padding: 10px 20px;-->
<!--            border-radius: 8px;-->
<!--            cursor: pointer;-->
<!--            font-size: 0.95em;-->
<!--            font-weight: 500;-->
<!--            transition: background-color 0.3s ease, transform 0.2s ease;-->
<!--            box-shadow: 0 3px 8px rgba(0,0,0,0.1);-->
<!--            text-decoration: none;-->
<!--            display: inline-block;-->
<!--            margin-top: 10px;-->
<!--        }-->

<!--        .btn-primary:hover, .btn-see-suspect:hover {-->
<!--            background-color: #3A7ABD;-->
<!--            transform: translateY(-2px);-->
<!--        }-->

<!--        .back-link {-->
<!--            margin-top: 30px;-->
<!--            display: inline-block;-->
<!--            color: var(&#45;&#45;primary-color);-->
<!--            text-decoration: none;-->
<!--            font-weight: 600;-->
<!--            font-size: 1.1em;-->
<!--            transition: color 0.3s ease;-->
<!--        }-->

<!--        .back-link:hover {-->
<!--            color: #3A7ABD;-->
<!--            text-decoration: underline;-->
<!--        }-->

<!--        .alert {-->
<!--            border-radius: 8px;-->
<!--            font-size: 1em;-->
<!--        }-->
<!--        .alert-info {-->
<!--            background-color: #D1ECF1;-->
<!--            color: #0C5460;-->
<!--            border-color: #BEE5EB;-->
<!--        }-->

<!--        /* Styles pour la localisation */-->
<!--        #locality {-->
<!--            font-weight: normal;-->
<!--        }-->
<!--        .map-link { /* Chang√© de #mapLink √† .map-link car l'ID est utilis√© pour plusieurs √©l√©ments */-->
<!--            margin-left: 8px;-->
<!--            color: var(&#45;&#45;primary-color);-->
<!--            text-decoration: none;-->
<!--            font-weight: 500;-->
<!--        }-->
<!--        .map-link:hover {-->
<!--            text-decoration: underline;-->
<!--            color: #3A7ABD;-->
<!--        }-->


<!--        @media (max-width: 768px) {-->
<!--            .sidebar {-->
<!--                display: none;-->
<!--            }-->

<!--            .main-content {-->
<!--                margin-left: 0;-->
<!--                width: 100%;-->
<!--                padding: 20px;-->
<!--            }-->

<!--            h2 {-->
<!--                font-size: 24px;-->
<!--                text-align: center;-->
<!--            }-->

<!--            .prediction-detail-card {-->
<!--                flex-direction: column;-->
<!--                align-items: flex-start;-->
<!--                padding: 15px;-->
<!--            }-->

<!--            .prediction-detail-img {-->
<!--                width: 100px; /* Ajustement pour les petits √©crans */-->
<!--                height: 100px; /* Ajustement pour les petits √©crans */-->
<!--                margin-bottom: 15px;-->
<!--            }-->

<!--            .prediction-detail-info {-->
<!--                width: 100%;-->
<!--            }-->

<!--            .btn-primary, .btn-see-suspect {-->
<!--                width: 100%;-->
<!--                text-align: center;-->
<!--            }-->
<!--        }-->
<!--    </style>-->
<!--</head>-->
<!--<body>-->

<!--<div class="sidebar">-->
<!--    <h3>Face AI</h3>-->
<!--    <a href="/add"><i class="fas fa-user-plus"></i> Ajouter un suspect</a>-->
<!--    <a href="/suspects"><i class="fas fa-users"></i> Liste des suspects</a>-->
<!--    <a href="/predictions/predictions"><i class="fas fa-eye"></i> Pr√©dictions</a>-->
<!--    <a href="/logout"><i class="fas fa-sign-out-alt"></i> D√©connexion</a>-->
<!--</div>-->

<!--<div class="main-content">-->
<!--    <h2 class="mb-4" th:text="'D√©tails des pr√©dictions pour : ' + ${predictedName}"></h2>-->

<!--    <div th:if="${predictions.isEmpty()}" class="alert alert-info">-->
<!--        Aucune pr√©diction trouv√©e pour cette identit√©.-->
<!--    </div>-->

<!--    <div th:each="suspect : ${predictions}" class="prediction-detail-card">-->
<!--        <img th:src="@{${suspect.imagePath}}" alt="Photo suspect" class="prediction-detail-img">-->
<!--        <div class="prediction-detail-info">-->
<!--            <p><strong>Nom :</strong> <span th:text="${suspect.name}"></span></p>-->
<!--            <p><strong>Pr√©nom :</strong> <span th:text="${suspect.firstname}"></span></p>-->
<!--            <p><strong>Date de l'√©v√©nement :</strong> <span th:text="${suspect.evtDate}"></span></p>-->
<!--            <p><strong>Document :</strong> <span th:text="${suspect.identityDocument}"></span></p>-->
<!--            <p><strong>Identifiant :</strong> <span th:text="${suspect.identityString}"></span></p>-->
<!--            <p><strong>Remarques :</strong> <span th:text="${suspect.remarqueText}"></span></p>-->
<!--            <p><strong>üìç Localit√© :</strong>-->
<!--                <span th:if="${suspect.lat != null and suspect.lng != null}">-->
<!--                    <span class="locality-data" th:data-lat="${suspect.lat}" th:data-lng="${suspect.lng}">-->
<!--                        Chargement...-->
<!--                    </span>-->
<!--                    <a class="map-link" target="_blank" style="display: none;">Voir sur la carte</a>-->
<!--                </span>-->
<!--&lt;!&ndash;                <span th:else>&ndash;&gt;-->
<!--&lt;!&ndash;                    Coordonn√©es indisponibles&ndash;&gt;-->
<!--&lt;!&ndash;                </span>&ndash;&gt;-->
<!--            </p>-->
<!--            <p><strong>Statut :</strong>-->
<!--                <span th:if="${suspect.statut == 1}">Analyse effectu√©e</span>-->
<!--                <span th:if="${suspect.statut == 0}">En attente d'analyse</span>-->
<!--            </p>-->
<!--            <a th:href="@{'/suspects/details/' + ${suspect.id}}" class="btn-see-suspect">-->
<!--                Voir le suspect-->
<!--            </a>-->
<!--        </div>-->
<!--    </div>-->

<!--    <a th:href="@{/predictions/predictions}" class="back-link">‚Üê Retour √† la liste des groupes</a>-->

<!--    <script th:inline="javascript">-->
<!--        window.onload = function () {-->
<!--            const localitySpans = document.querySelectorAll('.locality-data');-->

<!--            localitySpans.forEach(span => {-->
<!--                const lat = span.dataset.lat;-->
<!--                const lng = span.dataset.lng;-->
<!--                const mapLink = span.nextElementSibling;-->

<!--                if (lat && lng && !isNaN(parseFloat(lat)) && !isNaN(parseFloat(lng))) {-->
<!--                    reverseGeocode(parseFloat(lat), parseFloat(lng), span, mapLink);-->
<!--                } else {-->
<!--                    span.innerText = "Coordonn√©es indisponibles";-->
<!--                    if (mapLink) mapLink.style.display = "none";-->
<!--                }-->
<!--            });-->
<!--        }-->

<!--        function reverseGeocode(lat, lng, spanElement, mapLinkElement) {-->
<!--            const url = `https://nominatim.openstreetmap.org/reverse?lat=${lat}&lon=${lng}&format=json`;-->

<!--            fetch(url, {-->
<!--                headers: {-->
<!--                    'User-Agent': 'facial-recognition-app/1.0 (contact@example.com)'-->
<!--                }-->
<!--            })-->
<!--                .then(response => {-->
<!--                    if (!response.ok) {-->
<!--                        if (response.status === 429) {-->
<!--                            throw new Error("Trop de requ√™tes. Veuillez r√©essayer plus tard.");-->
<!--                        }-->
<!--                        throw new Error(`Erreur HTTP: ${response.status}`);-->
<!--                    }-->
<!--                    return response.json();-->
<!--                })-->
<!--                .then(data => {-->
<!--                    if (data && data.display_name) {-->
<!--                        spanElement.innerText = data.display_name;-->
<!--                        if (mapLinkElement) {-->
<!--                            mapLinkElement.href = `https://www.openstreetmap.org/?mlat=${lat}&mlon=${lng}#map=12/${lat}/${lng}`;-->
<!--                            mapLinkElement.style.display = "inline";-->
<!--                        }-->
<!--                    } else if (data && data.address) {-->
<!--                        const addressComponents = [];-->
<!--                        if (data.address.house_number) addressComponents.push(data.address.house_number);-->
<!--                        if (data.address.road) addressComponents.push(data.address.road);-->
<!--                        if (data.address.postcode) addressComponents.push(data.address.postcode);-->
<!--                        if (data.address.city || data.address.town || data.address.village) {-->
<!--                            addressComponents.push(data.address.city || data.address.town || data.address.village);-->
<!--                        }-->
<!--                        if (data.address.country) addressComponents.push(data.address.country);-->

<!--                        const constructedAddress = addressComponents.filter(Boolean).join(', ');-->
<!--                        spanElement.innerText = constructedAddress || "Adresse introuvable";-->
<!--                        if (mapLinkElement) {-->
<!--                            mapLinkElement.href = `https://www.openstreetmap.org/?mlat=${lat}&mlon=${lng}#map=12/${lat}/${lng}`;-->
<!--                            mapLinkElement.style.display = "inline";-->
<!--                        }-->
<!--                    } else {-->
<!--                        spanElement.innerText = "Adresse introuvable";-->
<!--                    }-->
<!--                })-->
<!--                .catch(err => {-->
<!--                    console.error("Erreur lors de la g√©olocalisation inverse:", err);-->
<!--                    spanElement.innerText = `Erreur: ${err.message || 'Impossible de charger l\'adresse'}`;-->
<!--                });-->
<!--        }-->
<!--    </script>-->
<!--</div>-->

<!--</body>-->
<!--</html>-->




<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <title th:text="'D√©tails des pr√©dictions pour ' + ${predictedName}"></title>
    <meta charset="UTF-8">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css" rel="stylesheet">
    <style>
        :root {
            --primary-color: #4A90E2;
            --secondary-color: #6C757D;
            --light-bg: #ECF0F1;
            --card-bg: #FFFFFF;
            --text-color: #34495E;
            --border-color: #DDE6ED;
            --dark-heading-color: #2C3E50;
        }

        body {
            margin: 0;
            padding: 0;
            background-color: var(--light-bg);
            font-family: 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
            display: flex;
            color: var(--text-color);
        }

        /* Styles de la sidebar */
        .sidebar {
            width: 220px;
            background-color: #1e1e2f;
            color: white;
            padding: 20px;
            height: 100vh;
            position: fixed;
            top: 0;
            left: 0;
            display: flex;
            flex-direction: column;
        }

        .sidebar h3 {
            text-align: center;
            margin-bottom: 30px;
            font-size: 24px;
        }

        .sidebar a {
            text-decoration: none;
            color: #ccc;
            padding: 12px;
            margin: 5px 0;
            border-radius: 8px;
            display: flex;
            align-items: center;
            transition: background 0.3s;
        }

        .sidebar a:hover {
            background-color: #333;
            color: #fff;
        }

        .sidebar i {
            margin-right: 10px;
        }

        /* Fin des styles de la sidebar */

        .main-content {
            margin-left: 220px;
            padding: 40px;
            flex-grow: 1;
            width: calc(100% - 220px);
        }

        h2 {
            color: var(--dark-heading-color);
            margin-bottom: 30px;
            font-weight: 600;
        }

        .prediction-detail-card {
            background-color: var(--card-bg);
            border-radius: 12px;
            padding: 25px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.08);
            margin-bottom: 25px;
            display: flex;
            align-items: center;
            gap: 25px;
            transition: transform 0.3s ease, box-shadow 0.3s ease;
        }

        .prediction-detail-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 8px 20px rgba(0, 0, 0, 0.12);
        }

        .prediction-detail-img {
            width: 160px;
            height: 160px;
            object-fit: cover;
            border-radius: 50%;
            border: 3px solid var(--primary-color);
            box-shadow: 0 3px 8px rgba(0,0,0,0.1);
            flex-shrink: 0;
        }

        .prediction-detail-info {
            flex-grow: 1;
            line-height: 1.6;
        }

        .prediction-detail-info p {
            margin-bottom: 8px;
            font-size: 1em;
            color: var(--text-color);
        }

        .prediction-detail-info strong {
            color: var(--dark-heading-color);
            min-width: 120px;
            display: inline-block;
        }

        .btn-primary, .btn-see-suspect {
            background-color: var(--primary-color);
            border: none;
            color: white;
            padding: 10px 20px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 0.95em;
            font-weight: 500;
            transition: background-color 0.3s ease, transform 0.2s ease;
            box-shadow: 0 3px 8px rgba(0,0,0,0.1);
            text-decoration: none;
            display: inline-block;
            margin-top: 10px;
        }

        .btn-primary:hover, .btn-see-suspect:hover {
            background-color: #3A7ABD;
            transform: translateY(-2px);
        }

        .back-link {
            margin-top: 30px;
            display: inline-block;
            color: var(--primary-color);
            text-decoration: none;
            font-weight: 600;
            font-size: 1.1em;
            transition: color 0.3s ease;
        }

        .back-link:hover {
            color: #3A7ABD;
            text-decoration: underline;
        }

        .alert {
            border-radius: 8px;
            font-size: 1em;
        }
        .alert-info {
            background-color: #D1ECF1;
            color: #0C5460;
            border-color: #BEE5EB;
        }

        /* Styles pour la localisation */
        #locality {
            font-weight: normal;
        }
        .map-link {
            margin-left: 8px;
            color: var(--primary-color);
            text-decoration: none;
            font-weight: 500;
        }
        .map-link:hover {
            text-decoration: underline;
            color: #3A7ABD;
        }

        @media (max-width: 768px) {
            .sidebar {
                display: none;
            }

            .main-content {
                margin-left: 0;
                width: 100%;
                padding: 20px;
            }

            h2 {
                font-size: 24px;
                text-align: center;
            }

            .prediction-detail-card {
                flex-direction: column;
                align-items: flex-start;
                padding: 15px;
            }

            .prediction-detail-img {
                width: 100px;
                height: 100px;
                margin-bottom: 15px;
            }

            .prediction-detail-info {
                width: 100%;
            }

            .btn-primary, .btn-see-suspect {
                width: 100%;
                text-align: center;
            }
        }
        .sidebar-button {
            background: none;
            border: none;
            color: #ccc; /* Couleur du texte des liens */
            padding: 12px;
            margin: 5px 0;
            border-radius: 8px;
            display: flex; /* Pour aligner l'ic√¥ne et le texte */
            align-items: center;
            width: 100%; /* Pour qu'il prenne toute la largeur disponible comme les liens */
            text-align: left; /* Pour aligner le texte √† gauche */
            cursor: pointer; /* Indique qu'il est cliquable */
            transition: background 0.3s, color 0.3s;
        }

        .sidebar-button:hover {
            background-color: #333;
            color: #fff;
        }

        /* Assurez-vous que l'ic√¥ne √† l'int√©rieur du bouton est √©galement stylis√©e */
        .sidebar-button i {
            margin-right: 10px;
        }
    </style>
</head>
<body>

<div class="sidebar">
    <h3>Face AI</h3>
    <a href="/add"><i class="fas fa-user-plus"></i> Ajouter un suspect</a>
    <a href="/suspects"><i class="fas fa-users"></i> Liste des suspects</a>
    <a href="/predictions/predictions"><i class="fas fa-eye"></i> Pr√©dictions</a>
    <a th:if="${#authorization.expression('hasRole(''ADMIN'')')}" href="/admin/users"><i class="fas fa-users-cog"></i> Gestion Utilisateurs</a>
<!--    <a href="/logout"><i class="fas fa-sign-out-alt"></i> D√©connexion</a>-->
    <form th:action="@{/logout}" method="post" style="display: inline;">
        <button type="submit" class="sidebar-button">
            <i class="fas fa-sign-out-alt"></i> D√©connexion
        </button>
        <input type="hidden" th:name="${_csrf.parameterName}" th:value="${_csrf.token}" />
    </form>
</div>

<div class="main-content">
    <h2 class="mb-4" th:text="'D√©tails des pr√©dictions pour : ' + ${predictedName}"></h2>

    <div th:if="${predictions.isEmpty()}" class="alert alert-info">
        Aucune pr√©diction trouv√©e pour cette identit√©.
    </div>

    <div th:each="suspect : ${predictions}" class="prediction-detail-card">
        <img th:src="@{${suspect.imagePath}}" alt="Photo suspect" class="prediction-detail-img">
        <div class="prediction-detail-info">
            <p><strong>Nom :</strong> <span th:text="${suspect.name}"></span></p>
            <p><strong>Pr√©nom :</strong> <span th:text="${suspect.firstname}"></span></p>
            <p><strong>Date de l'√©v√©nement :</strong> <span th:text="${suspect.evtDate}"></span></p>
            <p><strong>Document :</strong> <span th:text="${suspect.identityDocument}"></span></p>
            <p><strong>Identifiant :</strong> <span th:text="${suspect.identityString}"></span></p>
            <p><strong>Remarques :</strong> <span th:text="${suspect.remarqueText}"></span></p>

<!--            AVEC OPENSTREETMAP-->
<!--            <p><strong>üìç Localit√© :</strong>-->
<!--                <span th:if="${suspect.lat != null and suspect.lng != null}">-->
<!--                    <span class="locality-data" th:data-lat="${suspect.lat}" th:data-lng="${suspect.lng}">-->
<!--                        Chargement...-->
<!--                    </span>-->
<!--                    <a class="map-link" target="_blank" style="display: none;">Voir sur la carte</a>-->
<!--                </span>-->
<!--                <span th:unless="${suspect.lat != null and suspect.lng != null}">-->
<!--                   Coordonn√©es indisponibles-->
<!--                </span>-->
<!--            </p>-->
                <p><strong>üìç Localit√© :</strong>
                    <span th:if="${suspect.lat != null and suspect.lng != null}">
            <span class="locality-data" th:data-lat="${suspect.lat}" th:data-lng="${suspect.lng}">
                Chargement...
            </span>
            <a class="map-link" th:href="'https://www.google.com/maps/search/?api=1&query=' + ${suspect.lat} + ',' + ${suspect.lng}" target="_blank" style="display: none;">Voir sur Google Maps</a>
        </span>
                    <span th:unless="${suspect.lat != null and suspect.lng != null}">
           Coordonn√©es indisponibles
        </span>
                </p>

            <a th:href="@{'/suspects/details/' + ${suspect.id}}" class="btn-see-suspect">
                Voir le suspect
            </a>
        </div>
    </div>
<!--SANS TRACAGE-->
<!--    <div th:if="${not #lists.isEmpty(locations)}">-->
<!--        <h3 class="mt-5 mb-3" style="color: var(&#45;&#45;dark-heading-color);">Voir toutes les localisations sur la carte :</h3>-->
<!--        <a th:href="@{'https://www.google.com/maps/dir/?api=1&waypoints=' + ${#strings.listJoin(locations, '|')} + '&travelmode=driving'}"-->
<!--           class="btn btn-primary mt-3" target="_blank">-->
<!--            Ouvrir la carte avec toutes les localisations-->
<!--        </a>-->
<!--    </div>-->
<!--    <div th:unless="${not #lists.isEmpty(locations)}" class="alert alert-info mt-3">-->
<!--        Aucune coordonn√©e disponible pour afficher la carte des localisations.-->
<!--    </div>-->

    <div th:if="${not #lists.isEmpty(locations)}">
        <h3 class="mt-5 mb-3" style="color: var(--dark-heading-color);">Voir toutes les localisations sur la carte :</h3>
        <a th:href="${
            (#lists.size(locations) == 1) ?
                'https://www.google.com/maps/search/?api=1&query=' + locations.get(0)
            :
                'https://www.google.com/maps/dir/?api=1' +
                '&origin=' + locations.get(0) +
                '&destination=' + locations.get(#lists.size(locations) - 1) +
                ((#lists.size(locations) > 2) ? '&waypoints=' + #strings.listJoin(locations.subList(1, #lists.size(locations) - 1), '|') : '') +
                '&travelmode=driving'
        }"
           class="btn btn-primary mt-3" target="_blank">
            Ouvrir la carte avec toutes les localisations
        </a>
    </div>
    <div th:unless="${not #lists.isEmpty(locations)}" class="alert alert-info mt-3">
        Aucune coordonn√©e disponible pour afficher la carte des localisations.
    </div>

    <a th:href="@{/predictions/predictions}" class="back-link">‚Üê Retour √† la liste des groupes</a>

    <script th:inline="javascript">
        // Le script JavaScript pour le g√©ocodage invers√© de CHAQUE localisation individuelle reste le m√™me
        window.onload = function () {
            const localitySpans = document.querySelectorAll('.locality-data');

            localitySpans.forEach(span => {
                const lat = span.dataset.lat;
                const lng = span.dataset.lng;
                const mapLink = span.nextElementSibling;

                if (lat && lng && !isNaN(parseFloat(lat)) && !isNaN(parseFloat(lng))) {
                    reverseGeocode(parseFloat(lat), parseFloat(lng), span, mapLink);
                } else {
                    span.innerText = "Coordonn√©es indisponibles";
                    if (mapLink) mapLink.style.display = "none";
                }
            });
        }
        // AVEC OPENSTREETMAP
        // function reverseGeocode(lat, lng, spanElement, mapLinkElement) {
        //     const url = `https://nominatim.openstreetmap.org/reverse?lat=${lat}&lon=${lng}&format=json`;
        //
        //     fetch(url, {
        //         headers: {
        //             'User-Agent': 'facial-recognition-app/1.0 (contact@example.com)'
        //         }
        //     })
        //         .then(response => {
        //             if (!response.ok) {
        //                 if (response.status === 429) {
        //                     throw new Error("Trop de requ√™tes. Veuillez r√©essayer plus tard.");
        //                 }
        //                 throw new Error(`Erreur HTTP: ${response.status}`);
        //             }
        //             return response.json();
        //         })
        //         .then(data => {
        //             if (data && data.display_name) {
        //                 spanElement.innerText = data.display_name;
        //                 if (mapLinkElement) {
        //                     mapLinkElement.href = `https://www.openstreetmap.org/?mlat=${lat}&mlon=${lng}#map=12/${lat}/${lng}`;
        //                     mapLinkElement.style.display = "inline";
        //                 }
        //             } else if (data && data.address) {
        //                 const addressComponents = [];
        //                 if (data.address.house_number) addressComponents.push(data.address.house_number);
        //                 if (data.address.road) addressComponents.push(data.address.road);
        //                 if (data.address.postcode) addressComponents.push(data.address.postcode);
        //                 if (data.address.city || data.address.town || data.address.village) {
        //                     addressComponents.push(data.address.city || data.address.town || data.address.village);
        //                 }
        //                 if (data.address.country) addressComponents.push(data.address.country);
        //
        //                 const constructedAddress = addressComponents.filter(Boolean).join(', ');
        //                 spanElement.innerText = constructedAddress || "Adresse introuvable";
        //                 if (mapLinkElement) {
        //                     mapLinkElement.href = `https://www.openstreetmap.org/?mlat=${lat}&mlon=${lng}#map=12/${lat}/${lng}`;
        //                     mapLinkElement.style.display = "inline";
        //                 }
        //             } else {
        //                 spanElement.innerText = "Adresse introuvable";
        //             }
        //         })
        //         .catch(err => {
        //             console.error("Erreur lors de la g√©olocalisation inverse:", err);
        //             spanElement.innerText = `Erreur: ${err.message || 'Impossible de charger l\'adresse'}`;
        //         });
        // }

        function reverseGeocode(lat, lng, spanElement, mapLinkElement) {
            const url = `https://nominatim.openstreetmap.org/reverse?lat=${lat}&lon=${lng}&format=json`;

            fetch(url, {
                headers: {
                    'User-Agent': 'facial-recognition-app/1.0 (contact@example.com)'
                }
            })
                .then(response => {
                    if (!response.ok) {
                        if (response.status === 429) {
                            throw new Error("Trop de requ√™tes. Veuillez r√©essayer plus tard.");
                        }
                        throw new Error(`Erreur HTTP: ${response.status}`);
                    }
                    return response.json();
                })
                .then(data => {
                    if (data && data.display_name) {
                        spanElement.innerText = data.display_name;
                        if (mapLinkElement) {
                            // NE PAS CHANGER mapLinkElement.href ICI, car Thymeleaf a d√©j√† g√©n√©r√© l'URL Google Maps.
                            // Il suffit de rendre le lien visible.
                            mapLinkElement.style.display = "inline";
                        }
                    } else if (data && data.address) {
                        const addressComponents = [];
                        if (data.address.house_number) addressComponents.push(data.address.house_number);
                        if (data.address.road) addressComponents.push(data.address.road);
                        if (data.address.postcode) addressComponents.push(data.address.postcode);
                        if (data.address.city || data.address.town || data.address.village) {
                            addressComponents.push(data.address.city || data.address.town || data.address.village);
                        }
                        if (data.address.country) addressComponents.push(data.address.country);

                        const constructedAddress = addressComponents.filter(Boolean).join(', ');
                        spanElement.innerText = constructedAddress || "Adresse introuvable";
                        if (mapLinkElement) {
                            // NE PAS CHANGER mapLinkElement.href ICI
                            mapLinkElement.style.display = "inline";
                        }
                    } else {
                        spanElement.innerText = "Adresse introuvable";
                    }
                })
                .catch(err => {
                    console.error("Erreur lors de la g√©olocalisation inverse:", err);
                    spanElement.innerText = `Erreur: ${err.message || 'Impossible de charger l\'adresse'}`;
                });
        }
    </script>
</div>

</body>
</html>